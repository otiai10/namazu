# ============================================================
# namazu - Test Environment
# ============================================================
#
# このファイルは、認証機能のテスト用設定テンプレートです。
# Email/Password 認証が有効なテストテナントを使用します。
#
# 使用方法:
#   cp .env.test.example .env.test
#   # 値を編集
#   ./scripts/test-auth.sh
#
# ============================================================

# ============================================================
# データソース設定
# ============================================================
#
# テスト時はサンドボックスを使用
# 30秒ごとにテストデータが配信される
#
NAMAZU_SOURCE_TYPE=p2pquake
NAMAZU_SOURCE_ENDPOINT=wss://api-realtime-sandbox.p2pquake.net/v2/ws

# ============================================================
# Firestore 設定
# ============================================================
#
# テスト用データベースを使用
# 本番データに影響を与えないよう分離
#
NAMAZU_STORE_PROJECT_ID=namazu-live
NAMAZU_STORE_DATABASE=localdev
NAMAZU_STORE_CREDENTIALS=namazu-live-XXXXXX-serviceaccount.json

# ============================================================
# REST API サーバー設定
# ============================================================
#
NAMAZU_API_ADDR=:8080

# ============================================================
# 認証設定 (テストテナント)
# ============================================================
#
# 【テストテナントとは】
# Identity Platform のマルチテナント機能を利用して、
# テスト専用の認証環境を分離しています。
#
# - localdev/production: Google OAuth のみ（実ユーザー用）
# - test tenant: Email/Password（自動テスト用）
#
# これにより:
# - テスト用アカウントを簡単に作成・削除できる
# - 本番ユーザーに影響を与えない
# - CI/CD での自動テストが可能
#
NAMAZU_AUTH_ENABLED=true
NAMAZU_AUTH_PROJECT_ID=namazu-live
NAMAZU_AUTH_CREDENTIALS=namazu-live-XXXXXX-serviceaccount.json

# テストテナント ID
# - Identity Platform Console で作成
# - Email/Password プロバイダーを有効化
# - テストユーザーを事前に作成しておく
#
NAMAZU_AUTH_TENANT_ID=test-hwuh8

# ============================================================
# Firebase REST API 設定 (テストスクリプト用)
# ============================================================
#
# Web API Key
# - Firebase Console > Project Settings > General > Web API Key
# - または Google Cloud Console > APIs & Services > Credentials
#
# 用途:
# - テストスクリプトが ID トークンを取得するために使用
# - アプリケーション本体では使用しない（Admin SDK を使用）
#
FIREBASE_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# ============================================================
# テストユーザー設定 (テストスクリプト用)
# ============================================================
#
# テスト用ユーザーの認証情報
# - Identity Platform Console でテストテナント内に作成
# - または Firebase Auth REST API で作成
#
# 複数ユーザーでのテスト:
#   TEST_EMAIL=user2@example.com TEST_PASSWORD=xxx ./scripts/test-auth.sh
#
TEST_EMAIL=testuser@example.com
TEST_PASSWORD=testpassword123

# ============================================================
# テストの実行方法
# ============================================================
#
# 【事前準備】
# 1. Identity Platform でテストテナントを作成
#    - Google Cloud Console > Identity Platform > Tenants
#    - "Add Tenant" で新規作成
#    - Email/Password プロバイダーを有効化
#
# 2. テストユーザーを作成
#    - Tenant の Users タブで "Add User"
#    - または Firebase Auth REST API:
#      curl -X POST \
#        "https://identitytoolkit.googleapis.com/v1/accounts:signUp?key=$FIREBASE_API_KEY" \
#        -H "Content-Type: application/json" \
#        -d '{"email":"test@example.com","password":"password123","tenantId":"your-tenant-id"}'
#
# 【テスト実行】
# 1. サーバーを起動（別ターミナル）
#    source .env.test && go run ./cmd/namazu/
#
# 2. 認証テストを実行
#    ./scripts/test-auth.sh
#
# 【テスト内容】
# - Email/Password でサインイン
# - /api/me でユーザープロファイル取得
# - /api/subscriptions で CRUD 操作
# - 所有権チェック（他ユーザーのデータにアクセスできないこと）
#
# ============================================================
# CI/CD での使用
# ============================================================
#
# GitHub Actions などで使用する場合:
#
# env:
#   NAMAZU_STORE_PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
#   NAMAZU_AUTH_TENANT_ID: ${{ secrets.TEST_TENANT_ID }}
#   FIREBASE_API_KEY: ${{ secrets.FIREBASE_API_KEY }}
#   ...
#
# steps:
#   - run: ./scripts/test-auth.sh
#
